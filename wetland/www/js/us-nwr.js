var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(l){console.log("Received Event: "+l);mapInit()}},mapInit=function(){console.log("Loading ArcGIS...");require({async:!0,parseOnLoad:!0});require("esri/dijit/AttributeInspector esri/dijit/InfoWindowLite esri/InfoTemplate esri/geometry/Point esri/geometry/screenUtils esri/geometry/webMercatorUtils esri/layers/FeatureLayer esri/tasks/locator esri/tasks/query esri/graphic esri/map esri/urlUtils esri/dijit/Geocoder esri/dijit/BasemapToggle esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/dijit/Scalebar dojo/_base/Color dojo/_base/connect dojo/_base/lang dojo/dom dojo/dom-construct dojo/dom-geometry dojo/has dojo/on dojo/parser dojo/ready dojo/window dojo/on dijit/form/ComboBox dojo/domReady!".split(" "),
function(l,T,A,I,pa,U,u,V,m,J,W,X,Y,Z,K,L,aa,M,B,ba,g,ca,N,C,h,da,ea,qa,ra){function fa(){B.connect(b,"onLayersAddResult",ga)}function ga(a){$("#spinStatus").show().delay(7E3).queue(function(a){$(this).hide();a()});var v=new l({layerInfos:[{featureLayer:d,showAttachments:!0,showDeleteButton:!1,isEditable:!0,fieldInfos:[{fieldName:"Comment",label:"Comment:",isEditable:!0,stringFieldOption:esri.dijit.AttributeInspector.STRING_FIELD_OPTION_TEXTAREA},{fieldName:"Email",label:"Email:",isEditable:!0}]}]},
"attributeDiv");B.connect(v,"onAttributeChange",function(a,b,n){a.attributes[b]=n;a.getLayer().applyEdits(null,[a],null)});$.each(a,function(a,n){$.each(n.layer.renderer.infos,function(a,n){var E=$("<li/>").on("click",function(a){b.setMapCursor("pointer");ha(n.label)});E.attr("data-theme","f");var v=[];v.push("<a href='#attributeDialog'>"+n.label+"</a>");E.append(v.join(""));$("#featureList").append(E)})})}function ha(a){var b=ia(a),c=new I(w);a=new Date;b=ba.mixin({},b.prototype.attributes);b.Date=
Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),0);a=new J(c,null,b);d.applyEdits([a],null,null,function(a){var b=new m;b.objectIds=[a[0].objectId];d.queryFeatures(b,function(a){0<a.features.length&&(esri.geometry.webMercatorToGeographic(a.features[0].geometry),O.locationToAddress(c,100,function(a){var b=[];a.address?(a.address.Address&&b.push(a.address.Address),a.address.City&&b.push(a.address.City+","),a.address.State&&b.push(a.address.State),
a.address.Zip&&b.push(a.address.Zip),a=b.join(" ")):a="No address for this location";$.mobile.changePage("#attributeDialog",null,!0,!0);$("#currentAddress")[0].textContent=a}))})})}function ia(a){var b=null;$.each(d.types,function(c,d){d.name===a&&(b=d.templates[0])});return b}function ja(){b.infoWindow.resize(180,75);var a=new A("<b>${WETLAND_TY}</b>","${ACRES} acres");e=new u("http://vgilab.unl.edu/arcgis/rest/services/NE_Wetlands_Map/MapServer/0",{mode:esri.layers.FeatureLayer.MODE_ONDEMAND,outFields:["WETLAND_TY",
"ACRES"],opacity:.5,infoTemplate:a});dojo.connect(e,"onClick",function(a){document.getElementById("esri.dijit.InfoWindowLite_0").style.zIndex="2000";var b=new m;b.geometry=a.mapPoint;e.selectFeatures(b,esri.layers.FeatureLayer.SELECTION_NEW)});d&&b.removeLayer(d);f&&b.removeLayer(f);b.addLayer(e);$("#addwetlandsButton").addClass("ui-disabled");$("#addsoilButton").removeClass("ui-disabled")}function ka(){b.infoWindow.resize(180,75);var a=new A("<b>${muname}</b>","${MUSYM} acres");f=new u("http://vgilab.unl.edu/arcgis/rest/services/NE_Soil_Survey_Map/MapServer/0",
{mode:esri.layers.FeatureLayer.MODE_ONDEMAND,outFields:["muname","MUSYM"],opacity:.5,infoTemplate:a});dojo.connect(f,"onClick",function(a){document.getElementById("esri.dijit.InfoWindowLite_0").style.zIndex="2000";var b=new m;b.geometry=a.mapPoint;f.selectFeatures(b,esri.layers.FeatureLayer.SELECTION_NEW)});d&&b.removeLayer(d);e&&b.removeLayer(e);b.addLayer(f);$("#addsoilButton").addClass("ui-disabled");$("#addwetlandsButton").removeClass("ui-disabled")}function la(){b.infoWindow.resize(180,100);
e&&b.removeLayer(e);f&&b.removeLayer(f);b.addLayer(d);$("#addsoilButton").addClass("ui-disabled");$("#addwetlandsButton").addClass("ui-disabled")}function F(){$("#addsoilButton").removeClass("ui-disabled");$("#addwetlandsButton").removeClass("ui-disabled")}function ma(){b.centerAndZoom(k,17);dojo.byId("info").innerHTML="Location: "+x}function G(){h(window,"deviceorientation",na);P=setInterval(Q,100)}function oa(a){dojo.disconnect(R);G()}function Q(){var a=y-(p-360*Math.floor(p/360));180<Math.abs(a)&&
(a=0>a?a+360:a-360);p+=a/5;a=p-window.orientation;g.byId("compassNeedle").style.webkitTransform="rotate("+a+"deg)"}function na(b){var c;void 0!=b.webkitCompassHeading?(y=360-b.webkitCompassHeading,c=b.webkitCompassAccuracy):null!=b.alpha&&(y=-1*(270-b.alpha),c=b.webkitCompassAccuracy);11>c?a.fillStyle="rgba(0, 205, 0, 0.9)":15<=c&&25>c?a.fillStyle="rgba(255, 255, 0, 0.9)":24<c&&(a.fillStyle="rgba(255, 0, 0, 0.9)");a.fill();-1==P&&Q()}var b,S,r,q,H,k,x,w,O,d,z,p,P=-1,y,t,a,e,f,c,R;ea(function(){function e(a){k=
esri.geometry.geographicToWebMercator(new I(a.coords.longitude,a.coords.latitude));m(k);b.centerAndZoom(k,17);x=U.xyToLngLat(k.x,k.y);console.log(x);dojo.byId("info").innerHTML="Location: "+x}function f(a){z?z.setGeometry(k):m(k)}function l(a){console.log("locationError: "+a.toString())}function m(a){var c=new L(L.STYLE_CIRCLE,12,new K(K.STYLE_SOLID,new M([0,52,113,.5]),8),new M([0,52,113,.9]));z=new J(a,c);b.graphics.add(z)}da.parse();window.addEventListener("onorientationchange"in window?"orientationchange":
"resize",function(){b&&(b.reposition(),b.resize())},!1);X.addProxyRule({urlPrefix:"vgilab.unl.edu",proxyUrl:"http://vgilab.unl.edu/proxy/proxy.ashx"});b=new W("map",{basemap:"streets",center:[-96.675345,40.809868],logo:!1,showAttribution:!1,wrapAround180:!0,slider:!1,zoom:11});b.on("load",function(){h(window,"resize",b,b.resize);navigator.geolocation?(navigator.geolocation.getCurrentPosition(e,l,{setHighAccuracy:!0}),navigator.geolocation.watchPosition(f,l)):alert("Device doesn't support Geolocation.");
window.location="#page-home";setTimeout(function(){$("#hoody").hide()},2550)});b.on("load",function(b){$(document).ready(fa);t=g.byId("compassHousing");t.style.height=t.style.width="75px";N.position(t);N.position(t);p=y=0;b=g.byId("compassFace");b.width=b.height=75;c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);b=yOffset=b.width/2;for(var d=0;360>d;++d){var e=37.5*Math.cos(d*Math.PI/180)+b,f=37.5*Math.sin(d*Math.PI/180)+yOffset,k=36*Math.cos(d*Math.PI/180)+b,l=36*Math.sin(d*Math.PI/180)+yOffset;
c.beginPath();c.moveTo(e,f);c.lineTo(k,l);c.closePath();c.stroke();d+=4}c.font="10px Arial";c.textAlign="center";b=c.measureText("N");c.fillText("N",37.5,15);c.fillText("S",37.5,65);c.fillText("E",37.5+(37.5-b.width),37.5);c.fillText("W",10,37.5);b=g.byId("compassNeedle");b.width=b.height=75;b.style.left=Math.floor(c.width/2)+"px";b.style.top=Math.floor(c.height/2)+"px";a=b.getContext("2d");a.translate(37.5,37.5);a.clearRect(a.canvas.width/2*-1,a.canvas.height/2*-1,a.canvas.width,a.canvas.height);
a.beginPath();a.lineWidth=1;a.moveTo(0,5);a.lineTo(0,37.5);a.stroke();a.beginPath();a.arc(0,22.5,8,0,2*Math.PI,!1);a.fillStyle="#FFF";a.fill();a.lineWidth=1;a.strokeStyle="black";a.stroke();a.beginPath();a.moveTo(0,0);a.font="normal 10px Verdana";a.fillStyle="#000";a.textAlign="center";a.fillText("S",0,27.5);a.beginPath();a.fillStyle="#000";a.moveTo(0,0);a.lineTo(0,18.75);a.lineTo(-1.875,0);a.fill();a.beginPath();a.fillStyle="#000";a.moveTo(0,0);a.lineTo(0,18.75);a.lineTo(1.875,0);a.fill();a.beginPath();
a.lineWidth=1;a.moveTo(0,0);a.lineTo(0,-37.5);a.stroke();a.beginPath();a.arc(0,-21.5,8,0,2*Math.PI,!1);a.fillStyle="#FFF";a.fill();a.lineWidth=1;a.strokeStyle="black";a.stroke();a.beginPath();a.moveTo(0,0);a.font="normal 10px Verdana";a.fillStyle="#000";a.textAlign="center";a.fillText("N",0,-17.5);a.beginPath();a.fillStyle="#000";a.moveTo(0,0);a.lineTo(0,-18.75);a.lineTo(-1.875,0);a.fill();a.beginPath();a.fillStyle="#000";a.moveTo(0,0);a.lineTo(0,-18.75);a.lineTo(1.875,0);a.fill();a.beginPath();a.arc(0,
0,10,0,2*Math.PI,!1);a.fillStyle="rgb(255,255,255)";a.fill();a.lineWidth=1;a.strokeStyle="black";a.stroke();a.beginPath();a.moveTo(0,0);a.arc(0,0,1.875,0,360*Math.PI/180,!1);a.fillStyle="#000";a.fill();C("ff")||C("ie")||C("opera")?(G(),alert("Your browser does not support WebKit.")):window.DeviceOrientationEvent?R=h(window,"deviceorientation",oa):G()});b.on("extent-change",function(){w=b.geographicExtent.getCenter();dojo.byId("info").innerHTML="Location: "+w.x+","+w.y});(new Z({map:b,basemap:"satellite"},
"BasemapToggle")).startup();new aa({map:b,scalebarUnit:"english"},dojo.byId("scalebar"));(new Y({map:b,autoComplete:!0,autoNavigate:!0},"search")).startup();dojo.connect(b,"onUpdateStart",function(){esri.show(dojo.byId("status"))});dojo.connect(b,"onUpdateEnd",function(){esri.hide(dojo.byId("status"))});H=new T(null,ca.create("div",null,null,b.root));H.startup();b.setInfoWindow(H);var D=new A;D.setTitle("<b>Report ${OBJECTID}</b>");D.setContent("Comment: ${Comment}<br>Date:${Date:DateFormat}<br><a id='linkClicked' href=#photoViewer>Check Photo</a>");
d=new u("http://vgilab.unl.edu/arcgis/rest/services/Wetland_Citizen_Reports/FeatureServer/0",{mode:u.MODE_ONDEMAND,infoTemplate:D,outFields:["*"]});q=document.createElement("img");q.src="images/no_photo_available.jpg";q.style.width="100%";q.style.height="100%";$("#link").html(q);B.connect(d,"onClick",function(a){document.getElementById("esri.dijit.InfoWindowLite_0").style.zIndex="2000";S=a.graphic.attributes[d.objectIdField];d.queryAttachmentInfos(S,function(a){r=document.createElement("img");a[0].url&&
(r.src=a[0].url,r.style.width="100%",r.style.height="100%",$("#link").html(r))})});b.addLayers([d]);b.infoWindow.resize(180,100);$("#photoBack").click(function(a){$("#link").html(q)});O=new V("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Locators/ESRI_Geocode_USA/GeocodeServer");h(g.byId("addwetlandsButton"),"click",ja);h(g.byId("addsoilButton"),"click",ka);h(g.byId("addreportButton"),"click",la);h(g.byId("finishButton"),"click",F);h(g.byId("featureBack"),"click",F);h(g.byId("gostudyButton"),
"click",F);h(g.byId("locationButton"),"click",ma)})})};app.initialize();